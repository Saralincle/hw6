# <center> 第六次作业  
### <center> 自动化63   
### <center> 林子航   
### <center> 2160508273   
### <center> 2019年4月1日  
## <center> 摘要  
&emsp;&emsp;本次实验实现了多种常见噪声的生成，包括高斯噪声和椒盐噪声；并设计了多种经典滤波器对这两种噪声进行消除，同时横向对比了各种滤波器的优劣。此外，本次实验还对lena图像进行了退化-复原的一系列流程，使用了维纳滤波器、约束最小二乘方滤波这两个经典的图像复原滤波器。  
&emsp;&emsp;实验一要求生成任意均值和方差的高斯噪声，并加在原图像中。利用服从高斯分布的随机数生成函数randn生成均值为0方差为1的随机数，并进行线性变化得到我们所需要的高斯噪声，再加至原图像。对存在高斯噪声的图像进行低通滤波，分别使用算术均值滤波器、几何均值滤波器、自适应滤波器等等对之进行滤波并对比分析，结论是各种滤波器的滤波效果大同小异，自适应局部去噪滤波器的效果最好。  
&emsp;&emsp;实验二要求生成密度为0.1的椒盐噪声并加在原图像上。使用Matlab库自带的imnoise函数添加椒盐噪声，并使用中值滤波器、逆谐波均值滤波器以及自适应中值滤波器对之进行去噪。比较不难发现，传统的中值滤波器虽能够去除椒盐噪声，但去除后会丢失图像的一些平滑细节；而逆谐波均值滤波器不但算法复杂度高，一次仅能去除一种噪声；效果最好的滤波器是自适应中值滤波器，不但能够完美地去噪，还保持了原图像的平滑细节。  
&emsp;&emsp;实验三要求对lena图像进行运动模糊处理并添加噪声，然后再分别使用维纳滤波器和约束最小二乘方滤波对之进行复原。实验中运动模糊处理的效果并不是很好，得到的结果给人的直观感受是像多张幻灯片叠加一般，没有剧烈运动的效果；而两种滤波器的滤波效果不尽人意，虽然可以去除添加的噪声，但模糊处理的痕迹依旧可以看出来。分析其原因可能是运动模糊处理这一步没有达到一个较好的效果，以及参数的选择不够优。    
&emsp;&emsp;通过本次实验，我对各种噪声的生成原理以及各种滤波器在图像处理中的作用更加了然于心，对图形的退化和重建也有了更深的体会。所有程序均为自己在研读算法之后独立编写完成的，虽然耗时巨大，但所获颇丰。  
## <center>实验一.高斯噪声的生成和滤波  
### 一.技术讨论  
&emsp;&emsp;高斯噪声是生活中最常见的噪声之一，其概率密度函数如下：  
![](https://i.imgur.com/cPAlvfc.png)  
&emsp;&emsp;其中z表示灰度值，σ表示噪声的标准差，![](https://i.imgur.com/T4q7ACs.png)表示噪声的均值。   
&emsp;&emsp;为了产生高斯噪声，可以使用matlab带有的随机函数randn()。该函数可以随机产生满足正态分布的值域为[0,1]的随机数，而要得到给定均值和方差的高斯噪声，只需要对随机数进行线性变换即可。值得注意的是，由于randn产生的是值域[0,1]，因此需要对给定的方差和均值进行归一化，即除以灰度值的最大值。高斯噪声的生成由独立编写的gnoise函数实现。  
&emsp;&emsp;在本次实验中由于图像是8bit的，应除以256。设f(x,y)为8bit的输入图像，g(x,y)为添加高斯噪声后的输出图像，则添加均值为m，方差为v的高斯噪声的表达式如下：  
![](https://i.imgur.com/FjPXMaw.png)  
&emsp;&emsp;由于噪声是高频分量，因此应使用低通滤波器进行滤波。常用的去噪滤波器包括算术平均值滤波器，几何均值滤波器，谐波均值滤波器以及逆谐波均值滤波器。以![](https://i.imgur.com/ODZMJy9.png)表示大小为m×n的邻域，g(s,t)表示原图像，f(x,y)表示空域滤波后的图像，给出几种去除均匀噪声的滤波器的表达式：      
&emsp;&emsp;1)算术均值滤波器：  
![](https://i.imgur.com/TKkonHJ.png)     
&emsp;&emsp;2)几何均值滤波器：  
![](https://i.imgur.com/HFhH1Ze.png)   
&emsp;&emsp;3)谐波均值滤波器：    
![](https://i.imgur.com/DIssVwm.png)  
&emsp;&emsp;谐波均值滤波器适合处理高斯噪声。  
&emsp;&emsp;4)中点滤波器：  
![](https://i.imgur.com/popO5V6.png)  
&emsp;&emsp;中点滤波器对随机分布的噪声去除效果最好，如高斯噪声或均匀噪声。  
&emsp;&emsp;5)阿尔法均值滤波器：  
![](https://i.imgur.com/AvqCsxl.png)  
&emsp;&emsp;其中d表示在邻域S内去掉g(s,t)最低灰度值的d/2个元素以及最高灰度值的d/2元素，剩下的元素组成gr(s,t)。阿尔法均值滤波器在图片包含多种噪声的情况下效果较好，例如高斯噪声和椒盐噪声混合的情况下。  
&emsp;&emsp;6)自适应局部降噪滤波器：  
![](https://i.imgur.com/xu01ywE.png)  
&emsp;&emsp;自适应局部降噪滤波器需要知道噪声和图像的局部方差以及图像的局部均值。在本次实验中，由于添加的噪声是已知方差的高斯噪声，因此可以用给定的方差作为已知量。自适应局部降噪滤波器能根据带有噪声的图像的方差信息和均值信息自适应地滤除均匀噪声。  
&emsp;&emsp;分别编写函数实现上述滤波器，并对添加噪声后的图像进行滤波，对比分析各滤波器的优缺点。  
### 二.实验结果  
&emsp;&emsp;统一添加均值为0，标准差为50的高斯噪声，所有滤波器的大小均为7×7。  
&emsp;&emsp;1.添加噪声后的图片：  
![](https://i.imgur.com/JfhH1cX.jpg)  
&emsp;&emsp;2.通过算术均值滤波器：    
![](https://i.imgur.com/hKxFPED.jpg)  
&emsp;&emsp;3.通过几何均值滤波器：      
![](https://i.imgur.com/Gsks0Q1.jpg)   
&emsp;&emsp;4.通过谐波均值滤波器：    
![](https://i.imgur.com/GgJBZaf.jpg)  
&emsp;&emsp;5.通过中点滤波器：    
![](https://i.imgur.com/8YkmgoH.jpg)  
&emsp;&emsp;6.通过阿尔法均值滤波器（d=8）：    
![](https://i.imgur.com/G1PAlMp.jpg)    
&emsp;&emsp;7.通过自适应局部降噪滤波器：    
![](https://i.imgur.com/mHFXfmg.jpg)  
### 三.结果分析  
&emsp;&emsp;1.算术均值滤波器：  
&emsp;&emsp;算术均值滤波器是应用十分广泛的低通滤波器之一，用于平滑图像，消除噪声。优点在于对于高斯噪声的处理效果很好，缺点是会模糊图像，损失一些细节。  
&emsp;&emsp;2.几何均值滤波器：  
&emsp;&emsp;几何均值滤波器与算术均值滤波器一样可以平滑图像，去除均匀噪声，且在处理中丢失的细节更少。但从图中可以看出，几何均值滤波器的一大缺点是由于卷积的补零特性以及几何均值滤波器的连乘形式，会造成图像的边框一定是黑色的，即会损失图像的边界信息而增添一个黑色的相框，这是我们所不期望的。  
&emsp;&emsp;3.谐波均值滤波器：  
&emsp;&emsp;谐波均值滤波器同样也是去除高斯噪声的滤波器的一种。与几何均值滤波器相似的是，谐波均值滤波器也会将图像的边框变成黑色，原因是卷积时补齐的0会使得滤波结果为0。但谐波均值滤波器的优点在于对图像的模糊没有那么严重，保存了大量的细节。  
&emsp;&emsp;4.中点滤波器：  
&emsp;&emsp;中点滤波器是统计排序滤波器的一种，可用于处理随机分布的噪声。但从处理结果来看，在我们的实验中中点滤波器的处理效果极差，可以看到噪声虽然被消除了，但图像也随之分块，原因是在邻域移动的过程中，最大值和最小值的变化是很小的，很多时候下一个邻域的最大值与最小值恰好就等于当前邻域的最大值与最小值。这样就会造成连续多个点的值相同，也就在视觉上出现了方块的效果。这种方块的效果随着滤波器的大小增大而更加明显。  
&emsp;&emsp;5.阿尔法均值滤波器：  
&emsp;&emsp;阿尔法均值滤波器在处理多种噪声的情况下十分有用，单独处理高斯噪声时，效果与算术均值滤波器差不多。  
&emsp;&emsp;6.自适应局部降噪滤波器：  
&emsp;&emsp;自适应局部降噪滤波器可根据局部方差的改变而改变输出的权重，达到消除噪声的效果。从图中可以看到，自适应局部降噪滤波器虽然可以消除噪声，但由于边缘的方差远远大于整体的方差，因此可能会出现边缘处清晰，平滑处模糊的这样一种不协调的情况。此外，自适应局部降噪滤波器还要求要已知噪声的方差，这一点在实际应用中难以做到。  
## <center>实验二.椒盐噪声的生成和滤波  
### 一.技术讨论  
&emsp;&emsp;椒盐噪声也是生活中相当常见的一种噪声，给出椒盐噪声的概率密度函数：  
![](https://i.imgur.com/r8sbUzH.png)   
&emsp;&emsp;使用matlab库自带的imnoise函数对图像添加密度为0.1的椒盐噪声。其中，密度为0.1意味着椒盐噪声的数量占图像总像素数的10%。椒盐噪声由于其独特的函数形式，需要使用统计排序滤波器才能获得比较好的去噪效果，给出几种常用的去除椒盐噪声的滤波器：   
&emsp;&emsp;1)中值滤波器：  
![](https://i.imgur.com/DWFG344.png)  
&emsp;&emsp;中值滤波器是最常用的用于去除椒盐噪声的滤波器之一。  
&emsp;&emsp;2)逆谐波均值滤波器：  
![](https://i.imgur.com/n1EUABK.png)  
&emsp;&emsp;其中Q称为滤波器的阶数。这种滤波器适合减少椒盐噪声的影响，当Q的值大于0时，该滤波器对胡椒噪声处理效果较好，当Q小于0时，该滤波器对盐粒噪声效果较好。  
&emsp;&emsp;3)自适应中值滤波器：  
&emsp;&emsp;自适应中值滤波算法由2个进程构成，表示为进程A和进程B，如下所示：  
&emsp;&emsp;进程A：![](https://i.imgur.com/NXtd3oz.png)，若A1>0且A2<0，则转进程B；否则增大邻域的大小，若超出最大领域大小，则输出![](https://i.imgur.com/BlenBFp.png)。  
&emsp;&emsp;进程B：![](https://i.imgur.com/XdCNIUh.png)，若B1>0且B2<0，则输出![](https://i.imgur.com/qlaMfdw.png)，否则输出![](https://i.imgur.com/604u6IV.png)。  
&emsp;&emsp;编写函数实现上述统计排序滤波器对椒盐噪声进行消除。  
### 二.实验结果  
1.添加密度为0.1的椒盐噪声后的图像：    
![](https://i.imgur.com/yAso6Jh.jpg)  
2.使用7×7大小的模板中值滤波后得到的图像  
![](https://i.imgur.com/CAB85GO.jpg)  
3.使用3×3大小的模板逆谐波均值滤波后得到的图像（Q=0.5）：    
![](https://i.imgur.com/BCPnbfz.jpg)  
4.使用3×3大小的模板逆谐波均值滤波后得到的图像（Q=-0.5）：  
![](https://i.imgur.com/EK3DD2M.jpg)  
5.使用自适应中值滤波器滤波后得到的图像：    
![](https://i.imgur.com/sW0Ugd8.jpg)  
### 三.结果分析  
&emsp;&emsp;从上述展示的实验结果来看，滤波效果最好的无疑是自适应的中值滤波器。下面对各个滤波器进行具体分析：    
&emsp;&emsp;1.中值滤波器：  
&emsp;&emsp;中值滤波器是处理椒盐噪声最常用的滤波器之一，实现及其简单，复杂度低，效果中规中矩。可以看到滤波后得到的图像完全没有了椒盐噪声，但会显得有些不自然，一些原本平滑过渡的地方在滤波后变得僵硬了，比如图片中的头发，在滤波后明显地失去了原先的自然弯卷，变得有些僵直。这是中值滤波器最大的缺点。    
&emsp;&emsp;2.逆谐波均值滤波器：  
&emsp;&emsp;逆谐波均值滤波器的阶数Q对滤波效果有着极大的影响。逆谐波均值滤波器无法同时处理胡椒噪声和盐粒噪声，在Q大于0时用于处理胡椒噪声，在Q小于0时用于处理盐粒噪声。从图中可以看到逆谐波均值滤波器单独处理胡椒噪声或者盐粒噪声的效果都并不好，会引入白色的或黑色的小方块。    
&emsp;&emsp;3.自适应中值滤波器：  
&emsp;&emsp;自适应中值滤波器有着很强的稳定性和健壮性，对椒盐噪声的处理效果极佳。可以从图中看到处理后的图像不但没有出现中值滤波器滤波后呈现的僵直的感觉，反而在去除了椒盐噪声的基础上最大可能地保护了原图像的细节。  
## <center>实验三.维纳滤波器和约束最小二乘方滤波  
### 一.技术讨论  
&emsp;&emsp;维纳滤波器和约束最小二乘方滤波都是用于图像复原的两种常见滤波器，本次实验要求实现这两种滤波器。  
&emsp;&emsp;1.维纳滤波器推导  
首先由图像i和噪声n的功率谱及图像与噪声的不相关性可得：![](https://i.imgur.com/4GX6bOB.png)  
![](https://i.imgur.com/FLw3Qc4.png)  
![](https://i.imgur.com/3wHq4Tb.png)  
&emsp;&emsp;在频域上，我们构造这样MSE的目标函数![](https://i.imgur.com/hLTvieE.png)  
&emsp;&emsp;其中![](https://i.imgur.com/ja55GK9.png)是观测图像并且可表示为![](https://i.imgur.com/PrtAFBV.png)，![](https://i.imgur.com/2e8CJy0.png)为维纳滤波器频谱，H为退化系统频谱。  
&emsp;&emsp;希望最小化这个关于![](https://i.imgur.com/oslCNTB.png)的目标函数能够取得最小值。即:  
![](https://i.imgur.com/rn37qIu.png)   
&emsp;&emsp;将![](https://i.imgur.com/AVnvUEu.png)带入并展开，由于噪声和原图像的不相关，展开得到下式：  
![](https://i.imgur.com/IqdcGvN.png)   
![](https://i.imgur.com/e9xzzFa.png)   
&emsp;&emsp;为求得最小值，对上式求偏导数，并令偏导数等于零可得：  
![](https://i.imgur.com/QlLRipO.png)    
&emsp;&emsp;整理并令:![](https://i.imgur.com/TEzfEYJ.png)   
&emsp;&emsp;得到恢复维纳滤波器为：![](https://i.imgur.com/QGJpup1.png)  

&emsp;&emsp;2.约束最小二乘方滤波  
&emsp;&emsp;约束最小二乘方滤波函数表达如下：  
![](https://i.imgur.com/PM7mdNP.png)   
&emsp;&emsp;其中系数gama需要通过迭代以满足所要求的精度。迭代步骤如下：  
&emsp;&emsp;1)给定初值（初值需要通过手动尝试确定大概数量级）；  
&emsp;&emsp;2)计算![](https://i.imgur.com/jzDvOan.png)，其中r(x,y)由下式得到：  
&emsp;&emsp;![](https://i.imgur.com/ZxEbC3z.png)  
&emsp;&emsp;3)若满足![](https://i.imgur.com/mY1OEH0.png)则停止，否则对γ进行更新，步长的选择可以参考牛顿-拉弗森算法。    
### 二.实验结果  
&emsp;&emsp;1.模糊退化后的图像:  
![](https://i.imgur.com/9PXpWmR.jpg)  
&emsp;&emsp;2.模糊退化后添加方差为10的高斯噪声的图像:  
![](https://i.imgur.com/m5Uojdi.jpg)  
&emsp;&emsp;3.维纳滤波器滤波后的结果（k=0.04)：  
![](https://i.imgur.com/moOhPTj.jpg)  
&emsp;&emsp;4.约束最小二乘方滤波（γ=8e-21)：  
![](https://i.imgur.com/7FM1dkH.jpg)  
### 三.结果分析  
&emsp;&emsp;从得到的结果来看，无论是维纳滤波器还是约束最小二乘方滤波，对本次实验的模糊运动退化的图像的复原效果并不理想。  
&emsp;&emsp;一般地，约束最小二乘方滤波对于高噪声和中等噪声的情况效果要由于维纳滤波器，而对于低噪声情况，两种滤波产生的基本相等的结果。此外，两种滤波器均受各自的参数的影响巨大。本次实验的结果不符合预期，很大原因就是参数的选取还有待商榷。  
&emsp;&emsp;对于维纳滤波器，在这次添加方差为10的高斯噪声的图像中，K值的人工选取具有很大的随机性。K值衡量的是噪声和原图像的频谱比值，而我根据噪声的方差大约为10，把原图像的频谱按255作为参考，得到近似的K=0.04得到上述结果，这显然不会是最优的参数值。  
&emsp;&emsp;对于约束最小二乘方滤波，在本次实验中γ的取值非常小，数量级仅有-18次方，而在此数量级之上得到的滤波效果极差，完全看不出来原先图像的形状内容。分析其原因，可能是模糊运动退化函数不够完善。从退化后的图像可以看到，退化的图像并不像预期的那样给人感觉急剧的运动造成的模糊，而更像是一张一张移位的幻灯片叠加在一起的结果。这其中缺失了什么，也许就是影响约束最小二乘方滤波效果的关键因素。      
## <center>实验感想  
&emsp;&emsp;本次实验实现了多种噪声的生成，并设计了多种常用滤波器对噪声进行处理，我对各种滤波器之间的差异和联系有了更深的理解。本次实验还进行了图像的退化和复原过程，让我更了解了退化函数的建模以及经典的维纳滤波器。所有程序均为自己在研读算法之后独立编写完成的，虽然耗时巨大，但所获颇丰。  